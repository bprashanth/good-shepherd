# Setup Wizard for Ecological Survey

## Overview

The setup wizard (`setup_wizard.html`) is an interactive HTML page that guides users through data entry for the Cestrum invasion study at Bikkapathy Mund, based on the field protocol described in `field_protocol_bkm.pdf`.

## How It Works

The wizard is generated by running `visualize_sites.py`, which:

1. Parses the KML file (`assets/sites.kml`) to extract features
2. Categorizes features by type (sites, transects, plots, subplots)
3. Creates an HTML page with progressive sections for each feature type
4. Each section includes:
   - A map showing only that feature type
   - A data entry form with protocol requirements
   - Information about what data is needed

## Generated Files

- `setup_wizard.html` - The main wizard interface
- `PROTOCOL_ANALYSIS.md` - Detailed analysis of protocol vs KML matching

## Wizard Sections

### Step 1: Sites (Shola Patches)
- **Protocol Requirement:** Four shola patches (two close: 150-350m, two far: >450m from settlement)
- **Found in KML:** Currently 2 sites (`Bikkapathimund_Shola_A`, `Biikkapathimund_Shola_B`)
- **Data Required:**
  - Site name/ID
  - Distance from settlement center
  - Proximity classification

### Step 2: Transects
- **Protocol Requirement:** Transects radiating from shola edge into interior, perpendicular to edge, minimum 50m separation
- **Found in KML:** Multiple transects (A_T1-7, B_T1-5)
- **Data Required:**
  - Transect ID
  - Associated shola patch
  - Distance from settlement
  - Orientation/direction

### Step 3: Plots (10x10m)
- **Protocol Requirement:** Five plots per transect at 0m, 10m, 20m, 40m, 60m from edge
- **Found in KML:** Multiple plots with density classifications (A_HD-*, A_MD-*, A_LD-*, A_VHD-*)
- **Data Required per Plot:**
  - Plot ID (link to transect and position)
  - DBH measurements for all woody individuals ≥1cm
  - Soil moisture at center (Dry+, Dry-, Normal, Wet-, Wet+)
  - Canopy openness at center (4 readings in cardinal directions)
  - Other observations (dung, lopping, trails, etc.)

### Step 4: Subplots (2x2m)
- **Protocol Requirement:** Four subplots per 10x10m plot, at corners, numbered 1-4 clockwise from left corner closest to edge
- **Found in KML:** ⚠️ None - need to be generated or provided
- **Data Required per Subplot:**
  - Subplot number (1-4)
  - Number of seedlings
  - Number of saplings
  - Grass cover (%)
  - Bare ground cover (%)
  - Soil moisture

## Usage

1. Run the visualization script:
   ```bash
   python3 visualize_sites.py
   ```

2. Open `setup_wizard.html` in a web browser

3. Navigate through each section to:
   - View features on the map
   - Review protocol requirements
   - Enter data for each feature

## Questions for User

Based on the analysis, the following questions need clarification:

1. **Sites:** Are there only 2 shola patches (A and B) or should there be 4 total? The protocol mentions 4 patches.

2. **Plot-Transect Relationship:** How are the plot polygons (A_HD-1, A_MD-1, etc.) related to transects? Do they correspond to specific positions along transects (0m, 10m, 20m, 40m, 60m)?

3. **Subplots:** Should subplots be automatically generated at plot corners, or do you have specific subplot locations in a separate file?

4. **Restoration Plots:** Are the restoration plots (cremation ground, temple) in a separate KML file, or should they be added?

5. **60m Segments:** What is the relationship between the "60m 1", "60m 2" line segments and the plots? Are these plot boundaries or something else?

## Next Steps

To make the wizard fully functional, you may want to:

1. Add JavaScript to handle form submissions
2. Connect to a backend API for data storage
3. Add validation based on protocol requirements
4. Generate subplot locations automatically from plot corners
5. Add export functionality (CSV, JSON, etc.)

## Technical Details

- **Map Library:** Folium (Python) generates Leaflet.js maps
- **KML Parsing:** XML ElementTree with namespace handling
- **Feature Categorization:** Based on naming patterns and geometry types
- **Coordinate System:** WGS84 (EPSG:4326)

